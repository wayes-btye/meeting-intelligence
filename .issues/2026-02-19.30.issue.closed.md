# [\#30 Issue](https://github.com/wayes-btye/meeting-intelligence/issues/30) `closed`: fix: resolve 218 mypy type errors across src/

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) opened issue at [2026-02-19 22:48](https://github.com/wayes-btye/meeting-intelligence/issues/30):

## Summary

CI (introduced in #28) runs \`mypy src/\` and found **218 pre-existing type errors** across 15 files. Ruff passes cleanly — this is mypy only.

## Error Categories

**1. Claude API content block union-attr (~150 errors)**
Files: \`src/retrieval/generation.py\`, \`src/evaluation/metrics.py\`, \`src/evaluation/generate_test_set.py\`, \`src/evaluation/cross_check.py\`

Pattern: code accesses \`.text\` directly on \`response.content[0]\` without narrowing the type:
```python
# current (fails mypy — block could be ThinkingBlock, ToolUseBlock, etc.)
response.content[0].text

# fix — narrow with isinstance
from anthropic.types import TextBlock
block = response.content[0]
if isinstance(block, TextBlock):
    block.text
```

**2. Supabase JSON return type (~50 errors)**
Files: \`src/api/routes/meetings.py\`, \`src/ingestion/storage.py\`, \`src/retrieval/search.py\`, \`src/api/routes/extraction.py\`

Pattern: Supabase \`.data\` returns \`JSON\` (a broad union type), code indexes it with string keys directly. Needs cast or type narrowing after the query.

**3. Bare dict without type params (~15 errors)**
Files: various — \`dict\` should be \`dict[str, Any]\` or more specific.

**4. Misc (~3 errors)**
- \`src/api/main.py:21\` — missing return type annotation on a function
- \`src/ingestion/parsers.py:166\` — \`no-any-return\`
- \`src/extraction/extractor.py:128\` — \`call-overload\` mismatch on \`messages.create\`

## Acceptance Criteria
- \`mypy src/\` exits 0
- \`make lint\` passes fully
- No functional behaviour changes

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) commented at [2026-02-21 00:33](https://github.com/wayes-btye/meeting-intelligence/issues/30#issuecomment-3937775716):

## Progress update

All 218 mypy errors resolved. PR #40 is open for review.

### Fixes applied across 16 files

**1. Claude API TextBlock narrowing** —  guard before  access in , , , 

**2. Supabase JSON casts** —  in , , , , , 

**3. CountMethod** — imported  from  and used  in , 

**4. Bare dict params** — parameterised as  in , , , , , , 

**5. Misc** — return type on ,  dispatch dict in ,  in , stale  comments removed

**Test fix** —  in  now returns a real  so  checks pass in tests.

### Results
- Success: no issues found in 35 source files → **0 errors** (was 218)
- All checks passed! → clean
- ============================= test session starts =============================
platform win32 -- Python 3.12.6, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\meeting-intelligence-wt6-issue-30
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.12.0, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 118 items / 3 deselected / 115 selected

tests\test_api.py ........                                               [  6%]
tests\test_config.py ..................                                  [ 22%]
tests\test_evaluation.py ................................                [ 50%]
tests\test_extraction.py ...............................                 [ 77%]
tests\test_health.py .                                                   [ 78%]
tests\test_ingestion.py .........................                        [100%]

============================== warnings summary ===============================
src\evaluation\models.py:35
  C:\meeting-intelligence-wt6-issue-30\src\evaluation\models.py:35: PytestCollectionWarning: cannot collect test class 'TestQuestion' because it has a __init__ constructor (from: tests/test_evaluation.py)
    @dataclass

tests/test_api.py::test_meetings_list
tests/test_config.py::TestQueryEndpointStrategy::test_accepts_semantic_strategy
tests/test_config.py::TestQueryEndpointStrategy::test_accepts_hybrid_strategy
tests/test_config.py::TestQueryEndpointStrategy::test_default_strategy_is_hybrid
tests/test_config.py::TestIngestEndpointStrategy::test_accepts_naive_strategy
tests/test_config.py::TestIngestEndpointStrategy::test_accepts_naive_strategy
tests/test_config.py::TestIngestEndpointStrategy::test_accepts_speaker_turn_strategy
tests/test_config.py::TestIngestEndpointStrategy::test_accepts_speaker_turn_strategy
tests/test_extraction.py::TestExtractEndpoint::test_extract_not_found
  C:\Users\User\AppData\Roaming\Python\Python312\site-packages\supabase\_sync\client.py:309: DeprecationWarning: The 'timeout' parameter is deprecated. Please configure it in the http client instead.
    return SyncPostgrestClient(

tests/test_api.py::test_meetings_list
tests/test_config.py::TestQueryEndpointStrategy::test_accepts_semantic_strategy
tests/test_config.py::TestQueryEndpointStrategy::test_accepts_hybrid_strategy
tests/test_config.py::TestQueryEndpointStrategy::test_default_strategy_is_hybrid
tests/test_config.py::TestIngestEndpointStrategy::test_accepts_naive_strategy
tests/test_config.py::TestIngestEndpointStrategy::test_accepts_naive_strategy
tests/test_config.py::TestIngestEndpointStrategy::test_accepts_speaker_turn_strategy
tests/test_config.py::TestIngestEndpointStrategy::test_accepts_speaker_turn_strategy
tests/test_extraction.py::TestExtractEndpoint::test_extract_not_found
  C:\Users\User\AppData\Roaming\Python\Python312\site-packages\supabase\_sync\client.py:309: DeprecationWarning: The 'verify' parameter is deprecated. Please configure it in the http client instead.
    return SyncPostgrestClient(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============== 115 passed, 3 deselected, 19 warnings in 41.74s =============== → **115 passed**, 0 failed


-------------------------------------------------------------------------------



[Export of Github issue for [wayes-btye/meeting-intelligence](https://github.com/wayes-btye/meeting-intelligence). Generated on 2026.02.23 at 04:25:17.]
