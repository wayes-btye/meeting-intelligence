# [\#38 PR](https://github.com/wayes-btye/meeting-intelligence/pull/38) `merged`: feat: React/Next.js frontend replacing Streamlit as demo UI (#32)

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) opened issue at [2026-02-20 12:29](https://github.com/wayes-btye/meeting-intelligence/pull/38):

## Summary

- **New `/frontend/` directory** ‚Äî Next.js 14 (App Router) + shadcn/ui + Tailwind CSS
- **Upload page** (`/`) ‚Äî drag-drop transcript ingest, chunking strategy selector, auto-extracts action items/decisions/topics after ingest
- **Chat page** (`/chat`) ‚Äî meeting dropdown (all 46 meetings loaded), question textarea, retrieval strategy toggle (semantic/hybrid), answer + source citations with speaker, timestamp, similarity score
- **Meetings browser** (`/meetings`) ‚Äî paginated table, click row ‚Üí detail panel with extracted items grouped by type
- **Nav + API status indicator** ‚Äî polls `GET /health` every 30s, shows green dot or ‚ö†Ô∏è API not reachable
- **CORS added** to `src/api/main.py` (only backend change)
- **chrome-devtools MCP** added to `.mcp.json` for live UI inspection during development

Closes #32

---

## Live test results (via chrome-devtools MCP against real API + Supabase)

- ‚úÖ `npm run build` ‚Äî clean, zero errors/warnings
- ‚úÖ Meetings page ‚Äî 46 MeetingBank meetings loaded, paginated (5 pages), row click opens detail panel
- ‚úÖ Chat page ‚Äî full round-trip: question ‚Üí API ‚Üí Claude ‚Üí answer card rendered
- ‚úÖ Upload page ‚Äî renders with drop zone, strategy selector, disabled button until file selected
- ‚úÖ API status dot ‚Äî green on all pages when API is up, ‚ö†Ô∏è when down

---

## Issues & challenges encountered

**1. API route prefix mismatch**
All routes are under `/api/` prefix (e.g. `/api/meetings`, `/api/ingest`, `/api/query`). The wt5 context doc showed bare paths. Discovered live via browser console errors and fixed in `lib/api.ts`.

**2. API schema mismatches**
Several field names differed from the wt5 spec. Discovered by hitting `/openapi.json` and comparing against the spec:
- `IngestResponse.chunks_created` ‚Üí `num_chunks`
- `Meeting.speaker_count` ‚Üí `num_speakers`
- `QueryRequest` uses single `strategy` field (not separate `chunking_strategy` + `retrieval_strategy`)
- `MeetingDetail.extracted_items` is `ExtractedItem[]` (flat array with `item_type` discriminator), not a nested `{action_items, decisions, topics}` object
- `ExtractResponse` returns `{action_items, decisions, topics}` as `ExtractedItem[]` arrays

**3. Stale uvicorn process blocking port 8000**
A uvicorn process from a previous Claude Code session remained bound to port 8000 without CORS headers. The new uvicorn with CORS couldn't evict it (Windows SO_REUSEADDR both listen). Worked around by running API on port 8002 (`NEXT_PUBLIC_API_URL=http://localhost:8002` in `.env.local`). **Action: kill the stale process (`taskkill /F /PID 22032` in CMD) and switch `.env.local` back to port 8000.**

**4. `.next` cache corruption**
Killing the Next.js dev server mid-compilation (during the port issue) corrupted the `.next` build cache ‚Äî chunks returned 404 and a module was missing. Fixed by `rm -rf .next` and clean restart.

**5. PowerShell through bash on Windows**
`$_` in PowerShell scripts gets expanded by bash as `extglob.*`. Worked around by using `Stop-Process -Id` directly without Where-Object pipelines.

---

## Risks

- **Port 8000 stale process** ‚Äî low risk, purely local dev issue. Resolves on machine restart.
- **`https://*.vercel.app` CORS wildcard** ‚Äî starlette treats this as a literal string (no wildcard subdomain support). Once the actual Vercel URL is known, replace with the exact domain in `src/api/main.py` `allow_origins`.
- **`strategy-selector.tsx` is unused** ‚Äî the component was scaffolded but both pages ended up with inline radio buttons (because Upload only needs chunking, Chat only needs retrieval). Safe to delete in a follow-up cleanup.

---

## Manual verification steps

1. `taskkill /F /PID 22032` (in CMD) to clear stale process, or restart machine
2. `uvicorn src.api.main:app --reload --port 8000` from repo root
3. Update `frontend/.env.local` ‚Üí `NEXT_PUBLIC_API_URL=http://localhost:8000`
4. `cd frontend && npm run dev`
5. Visit `http://localhost:3000` ‚Äî verify green API dot
6. Upload a `.vtt` file ‚Üí confirm extraction results appear
7. `/chat` ‚Üí ask "What decisions were made about the budget?" ‚Üí confirm answer + sources
8. `/meetings` ‚Üí click a row ‚Üí confirm detail panel appears

---

## Vercel deployment (after Cloud Run is live ‚Äî Issue #31)

**1.** Push this branch / merge to main
**2.** vercel.com ‚Üí New Project ‚Üí Import repo ‚Üí Root Directory: `frontend`
**3.** Add env var: `NEXT_PUBLIC_API_URL=<Cloud Run URL>`
**4.** Add Vercel URL to `allow_origins` in `src/api/main.py` and redeploy API

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) commented at [2026-02-20 12:37](https://github.com/wayes-btye/meeting-intelligence/pull/38#issuecomment-3934051815):

@claude review

#### <img src="https://avatars.githubusercontent.com/in/1236702?v=4" width="50">[claude](https://github.com/apps/claude) commented at [2026-02-20 12:37](https://github.com/wayes-btye/meeting-intelligence/pull/38#issuecomment-3934054476):

**Claude finished @wayes-btye's task in 2m 9s** ‚Äî‚Äî [View job](https://github.com/wayes-btye/meeting-intelligence/actions/runs/22224385869)

---
### PR Review: feat/32-react-frontend

**Tasks:**
- [x] Gather context and understand request
- [x] Read key source files
- [x] Review backend changes (`src/api/main.py`)
- [x] Review API client and types (`frontend/lib/api.ts`)
- [x] Review page components (upload, chat, meetings)
- [x] Review shared components and config
- [x] Synthesize and post full review

---

## Summary

Solid implementation overall ‚Äî the schema corrections, live test results, and honest documentation of issues are all good signs. Three things need fixing before merge: two broken E2E tests and the meetings detail race condition. The CORS wildcard is also a known issue that should be resolved before any Vercel deploy.

---

### P1 ‚Äî Bugs

**1. E2E tests have wrong assertions ‚Äî will fail in CI**

`upload.spec.ts:37` asserts `getByText("Retrieval Strategy")` but the upload page only has a **Chunking Strategy** fieldset ‚Äî there is no "Retrieval Strategy" label there. Likewise `chat.spec.ts:20` asserts `getByText("Chunking Strategy")` but the chat page only has a **Retrieval Strategy** radio group. These look like copy-paste errors from when the `strategy-selector.tsx` component was split apart.

```
// upload.spec.ts:37 ‚Äî FAILS, upload page has no "Retrieval Strategy"
await expect(page.getByText("Retrieval Strategy")).toBeVisible();

// chat.spec.ts:20 ‚Äî FAILS, chat page has no "Chunking Strategy"
await expect(page.getByText("Chunking Strategy")).toBeVisible();
```

[Fix this ‚Üí](https://claude.ai/code?q=In%20the%20feat%2F32-react-frontend%20branch%2C%20fix%20two%20broken%20E2E%20test%20assertions%3A%201%29%20In%20frontend%2Fe2e%2Fupload.spec.ts%20line%2037%2C%20remove%20or%20fix%20%60getByText%28%22Retrieval%20Strategy%22%29%60%20%E2%80%94%20the%20upload%20page%20only%20has%20%22Chunking%20Strategy%22%20not%20%22Retrieval%20Strategy%22.%202%29%20In%20frontend%2Fe2e%2Fchat.spec.ts%20line%2020%2C%20remove%20or%20fix%20%60getByText%28%22Chunking%20Strategy%22%29%60%20%E2%80%94%20the%20chat%20page%20only%20has%20%22Retrieval%20Strategy%22%20not%20%22Chunking%20Strategy%22.&repo=wayes-btye/meeting-intelligence)

**2. Race condition in meeting detail fetch** (confirmed from Codex review)

`meetings/page.tsx:39-48` ‚Äî the `useEffect` fires a new `getMeeting` call each time `selected` changes, but never cancels the previous in-flight request. If the user clicks meeting A (slow API) then meeting B (fast API), B resolves first ‚Üí `setDetail(B)`, then A resolves ‚Üí `setDetail(A)`, overwriting with the wrong data.

```tsx
// meetings/page.tsx:43-47 ‚Äî no cancellation of previous request
useEffect(() => {
  if (!selected) return;
  setDetailLoading(true);
  setDetail(null);
  api.getMeeting(selected).then(setDetail)  // ‚Üê no AbortController, no stale-close check
    .catch(console.error)
    .finally(() => setDetailLoading(false));
}, [selected]);
```

Fix: capture `selected` at effect entry and discard responses that don't match:
```tsx
useEffect(() => {
  if (!selected) return;
  const id = selected;
  setDetailLoading(true);
  setDetail(null);
  api.getMeeting(id)
    .then((data) => { if (id === selected) setDetail(data); })
    .catch(console.error)
    .finally(() => { if (id === selected) setDetailLoading(false); });
}, [selected]);
```

[Fix this ‚Üí](https://claude.ai/code?q=In%20the%20feat%2F32-react-frontend%20branch%2C%20fix%20the%20race%20condition%20in%20frontend%2Fapp%2Fmeetings%2Fpage.tsx%20around%20lines%2039-48.%20The%20useEffect%20that%20loads%20meeting%20detail%20on%20selected%20change%20does%20not%20cancel%20previous%20in-flight%20requests.%20Fix%20by%20capturing%20the%20selected%20id%20at%20effect%20entry%20and%20only%20calling%20setDetail%20and%20setDetailLoading%20if%20the%20selected%20value%20still%20matches%20at%20resolution%20time.&repo=wayes-btye/meeting-intelligence)

**3. CORS wildcard `https://*.vercel.app` is a literal string** (also noted in PR)

`src/api/main.py:20` ‚Äî Starlette's `CORSMiddleware` does not support glob/wildcard subdomain matching in `allow_origins`. `"https://*.vercel.app"` will never match `https://my-app-abc123.vercel.app`. Any browser request from a Vercel preview deploy will fail preflight.

Fix: use `allow_origin_regex` instead:
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000", "http://localhost:8501"],
    allow_origin_regex=r"https://.*\.vercel\.app",
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

[Fix this ‚Üí](https://claude.ai/code?q=In%20the%20feat%2F32-react-frontend%20branch%2C%20fix%20src%2Fapi%2Fmain.py%20line%2020.%20Replace%20the%20literal%20string%20%22https%3A%2F%2F*.vercel.app%22%20in%20allow_origins%20with%20an%20allow_origin_regex%20parameter%20set%20to%20the%20regex%20r%22https%3A%2F%2F.*%5C.vercel%5C.app%22%20so%20that%20Starlette%20actually%20matches%20Vercel%20preview%20subdomain%20URLs.&repo=wayes-btye/meeting-intelligence)

---

### P2 ‚Äî Quality

**4. Drop zone doesn't validate file type on drag-and-drop**

`frontend/app/page.tsx:38-43` ‚Äî The `<input accept=".vtt,.txt,.json">` attribute only constrains the file picker dialog. When a file is dragged in, `e.dataTransfer.files[0]` accepts anything. A user dropping a `.pdf` or `.exe` would send it to the API, which would presumably error, but the frontend gives no indication it rejected at the client level.

Minimal guard in `handleDrop`:
```tsx
const ACCEPTED = [".vtt", ".txt", ".json"];
const handleDrop = useCallback((e: React.DragEvent) => {
  e.preventDefault();
  setIsDragging(false);
  const dropped = e.dataTransfer.files[0];
  if (!dropped) return;
  const ok = ACCEPTED.some((ext) => dropped.name.endsWith(ext));
  if (ok) setFile(dropped);
  else setError("Unsupported file type. Drop a .vtt, .txt, or .json file.");
}, []);
```

**5. `key={i}` throughout extraction lists**

`meetings/page.tsx:205,233,254` and `page.tsx:225,252,275` ‚Äî Array index keys are fine for truly static lists but will cause silent reconciliation bugs if items are ever reordered, filtered, or removed. The `ExtractedItem` type has no stable `id` field, but `content` is unique enough to use as a key:
```tsx
// e.g.:
{actionItems.map((item) => <li key={item.content} ...>)}
```

**6. `onKeyDown` handler uses a type cast to `React.FormEvent`**

`frontend/app/chat/page.tsx:99` ‚Äî `void handleSubmit(e as unknown as React.FormEvent)` is semantically incorrect. `handleSubmit` calls `e.preventDefault()` expecting a form event, but receives a keyboard event that has already had `preventDefault` called. It works by accident, but is misleading. A cleaner approach is to extract the submit logic:
```tsx
const submitQuery = async () => { /* ... move the try/catch here ... */ };
// in form: onSubmit={(e) => { e.preventDefault(); void submitQuery(); }}
// in onKeyDown: if (e.key === "Enter" && (e.metaKey || e.ctrlKey)) void submitQuery();
```

---

### P3 ‚Äî Minor

**7. `allow_credentials=True` with no credentials**

`src/api/main.py:22` ‚Äî `allow_credentials=True` tells browsers to include cookies and auth headers. Since this API has no authentication, this is unnecessarily permissive. Set to `False` unless credentials are needed.

**8. `MeetingDetail.chunks` loaded but never displayed**

`frontend/lib/api.ts:62` ‚Äî The `MeetingDetail` type includes `chunks: SourceChunk[]`, and the API sends all chunk content in that field. The meetings detail panel in `meetings/page.tsx` only renders `extracted_items` and doesn't show chunks at all. This wastes bandwidth for meetings with large transcripts. Consider either displaying chunks or removing the field from the type until it's needed.

**9. Fake progress bar**

`frontend/app/page.tsx:52-63` ‚Äî Progress jumps from 0 ‚Üí 20 ‚Üí 60 ‚Üí 100 at hardcoded points with no relation to actual operation duration. This is fine for a demo, but worth noting that the bar doesn't reflect real progress. If ingest takes 30s, it sits at 20% for 28s then jumps.

---

### Minor nits

- `strategy-selector.tsx` is dead code (acknowledged in PR) ‚Äî safe to delete in a follow-up
- `formatDate` in `meetings/page.tsx:269` is defined locally but identical logic could be shared via `lib/utils.ts` if a third page needs it

---

### What's good

- Schema corrections documented clearly and matched against `/openapi.json` ‚Äî good discipline
- `apiFetch` error handling correctly reads `res.text()` only in the error branch
- `ApiStatus` polling with cleanup on unmount (`clearInterval`) is correct
- E2E fixture auto-creation in `beforeAll` is pragmatic
- `data-testid` attributes on key elements make tests maintainable
- CORS and port issues are honestly documented as risks


-------------------------------------------------------------------------------



[Export of Github issue for [wayes-btye/meeting-intelligence](https://github.com/wayes-btye/meeting-intelligence). Generated on 2026.02.27 at 04:14:01.]
