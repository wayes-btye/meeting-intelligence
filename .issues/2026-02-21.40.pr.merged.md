# [\#40 PR](https://github.com/wayes-btye/meeting-intelligence/pull/40) `merged`: fix: resolve all mypy type errors across src/ (closes #30)

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) opened issue at [2026-02-21 00:31](https://github.com/wayes-btye/meeting-intelligence/pull/40):

## Summary

Resolves all 218 pre-existing mypy errors across 15 source files. `mypy src/` now exits 0, `ruff` stays clean, and all 115 non-expensive tests pass.

## Changes by category

**1. Claude API TextBlock union-attr (~11 errors)**
- Files: `generation.py`, `metrics.py`, `generate_test_set.py`, `cross_check.py`
- Fix: narrow `response.content[0]` with `isinstance(block, TextBlock)` before accessing `.text`; raises `ValueError` on unexpected block type

**2. Supabase JSON return type (~50 errors)**
- Files: `storage.py`, `search.py`, `router.py`, `meetings.py`, `extraction.py`, `runner.py`
- Fix: `cast(list[dict[str, Any]], result.data)` after each `.execute()` call

**3. CountMethod arg-type (2 errors)**
- Files: `ingest.py`, `meetings.py`
- Fix: import `CountMethod` from `postgrest` and pass `CountMethod.exact` instead of bare string `"exact"` (mypy infers that as `str`, not `CountMethod`)

**4. Bare dict without type params (~15 errors)**
- Files: `models.py`, `generation.py`, `metrics.py`, `generate_test_set.py`, `search.py`, `cross_check.py`, `runner.py`
- Fix: parameterise as `dict[str, Any]` throughout

**5. Misc (5 errors)**
- `api/main.py`: added `-> dict[str, str]` return type to `health()`
- `ingestion/parsers.py`: typed dispatch dict as `dict[str, Callable[[str], list[TranscriptSegment]]]`, eliminating both `operator` and `no-any-return` errors; removed `# type: ignore[operator]`
- `extraction/extractor.py`: cast `EXTRACTION_TOOL` to `ToolParam` and `tool_choice` dict to `ToolChoiceToolParam` to resolve `call-overload` mismatch
- `retrieval/router.py`: replaced wrong `# type: ignore[no-any-return]` with `cast(list[dict[str, Any]], result.data)`
- `evaluation/runner.py`: removed stale `# type: ignore[import-untyped]` on supabase import (supabase now ships stubs)

**Test fix**
- `tests/test_evaluation.py`: `_mock_claude_response()` now returns a real `TextBlock` instance instead of `MagicMock`, so `isinstance` checks in production code pass

## Test plan

- [x] `mypy src/` ‚Üí **0 errors** (was 218)
- [x] `ruff check src/ tests/` ‚Üí clean
- [x] `pytest -m "not expensive"` ‚Üí **115 passed**, 0 failed
- [ ] No functional behaviour changes ‚Äî all changes are type narrowing, casts, and annotations only

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) commented at [2026-02-21 00:59](https://github.com/wayes-btye/meeting-intelligence/pull/40#issuecomment-3937823869):

@codex review this please

#### <img src="https://avatars.githubusercontent.com/in/1144995?v=4" width="50">[chatgpt-codex-connector](https://github.com/apps/chatgpt-codex-connector) commented at [2026-02-21 01:03](https://github.com/wayes-btye/meeting-intelligence/pull/40#issuecomment-3937829867):

Codex Review: Didn't find any major issues. Delightful!

<details> <summary>‚ÑπÔ∏è About Codex in GitHub</summary>
<br/>

[Your team has set up Codex to review pull requests in this repo](http://chatgpt.com/codex/settings/general). Reviews are triggered when you
- Open a pull request for review
- Mark a draft as ready
- Comment "@codex review".

If Codex has suggestions, it will comment; otherwise it will react with üëç.




Codex can also answer questions or update the PR. Try commenting "@codex address that feedback".
            
</details>


-------------------------------------------------------------------------------



[Export of Github issue for [wayes-btye/meeting-intelligence](https://github.com/wayes-btye/meeting-intelligence). Generated on 2026.02.21 at 04:07:53.]
