# [\#55 PR](https://github.com/wayes-btye/meeting-intelligence/pull/55) `merged`: feat: email/password login via Supabase Auth (#52)

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) opened issue at [2026-02-21 09:49](https://github.com/wayes-btye/meeting-intelligence/pull/55):

Closes #52

## What this adds
- `/login` page with email/password form (shadcn Input + Button components)
- Next.js middleware redirecting unauthenticated users to `/login`
- Logout button added to nav in `components/nav.tsx`
- `frontend/lib/supabase.ts` — browser client using `@supabase/ssr`
- No backend changes — session handled client-side by `@supabase/ssr`

## Manual steps required (user)
- Add `NEXT_PUBLIC_SUPABASE_ANON_KEY` to `frontend/.env.local` (get from Supabase dashboard → Settings → API)
- Add both Supabase env vars to Vercel dashboard environment variables
- Create the assessor user in Supabase dashboard → Authentication → Users → Add user

## Test plan
- `npm run build` passes (TypeScript clean)
- Unauthenticated visit to `/` → redirected to `/login`
- Valid credentials → home page
- Invalid credentials → error message shown
- Sign out → back to `/login`

#### <img src="https://avatars.githubusercontent.com/in/8329?v=4" width="50">[vercel](https://github.com/apps/vercel) commented at [2026-02-21 09:49](https://github.com/wayes-btye/meeting-intelligence/pull/55#issuecomment-3938529570):

[vc]: #e12FLca28owwr4uusvC3eyuibk1IdRPPn8BCB7fJ6lo=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJtZWV0aW5nLWludGVsbGlnZW5jZS13YyIsInByb2plY3RJZCI6InByal8yeVpsaThhOGFGYmdwR28xYXBHeTN6cFN3MzNrIiwiaW5zcGVjdG9yVXJsIjoiaHR0cHM6Ly92ZXJjZWwuY29tL3dheWVzLWJ0eWVzLXByb2plY3RzL21lZXRpbmctaW50ZWxsaWdlbmNlLXdjLzZFUFplUmRENkJLWU5rb21nQzNYRHBLUlBRRGMiLCJwcmV2aWV3VXJsIjoibWVldGluZy1pbnRlbGxpZ2VuY2Utd2MtZ2l0LWZlYXQtNTItYzU4ZDU2LXdheWVzLWJ0eWVzLXByb2plY3RzLnZlcmNlbC5hcHAiLCJuZXh0Q29tbWl0U3RhdHVzIjoiREVQTE9ZRUQiLCJsaXZlRmVlZGJhY2siOnsicmVzb2x2ZWQiOjAsInVucmVzb2x2ZWQiOjAsInRvdGFsIjowLCJsaW5rIjoibWVldGluZy1pbnRlbGxpZ2VuY2Utd2MtZ2l0LWZlYXQtNTItYzU4ZDU2LXdheWVzLWJ0eWVzLXByb2plY3RzLnZlcmNlbC5hcHAifSwicm9vdERpcmVjdG9yeSI6ImZyb250ZW5kIn1dfQ==
The latest updates on your projects. Learn more about [Vercel for GitHub](https://vercel.link/github-learn-more).

| Project | Deployment | Actions | Updated (UTC) |
| :--- | :----- | :------ | :------ |
| [meeting-intelligence-wc](https://vercel.com/wayes-btyes-projects/meeting-intelligence-wc) | ![Ready](https://vercel.com/static/status/ready.svg) [Ready](https://vercel.com/wayes-btyes-projects/meeting-intelligence-wc/6EPZeRdD6BKYNkomgC3XDpKRPQDc) | [Preview](https://meeting-intelligence-wc-git-feat-52-c58d56-wayes-btyes-projects.vercel.app), [Comment](https://vercel.live/open-feedback/meeting-intelligence-wc-git-feat-52-c58d56-wayes-btyes-projects.vercel.app?via=pr-comment-feedback-link) | Feb 21, 2026 1:48pm |

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) commented at [2026-02-21 10:15](https://github.com/wayes-btye/meeting-intelligence/pull/55#issuecomment-3938557104):

@claude review this

#### <img src="https://avatars.githubusercontent.com/in/1236702?v=4" width="50">[claude](https://github.com/apps/claude) commented at [2026-02-21 10:15](https://github.com/wayes-btye/meeting-intelligence/pull/55#issuecomment-3938557378):

**Claude finished @wayes-btye's task in 2m 2s** —— [View job](https://github.com/wayes-btye/meeting-intelligence/actions/runs/22255037976)

---
### PR Review: feat/52-supabase-auth

- [x] Gather context
- [x] Read changed files
- [x] Analyze security, correctness, and best practices
- [x] Post review

---

### Overall assessment

The implementation is clean and follows Supabase's official SSR patterns correctly. Two issues need attention before merging — one is a real regression blocker (E2E tests), one is a defensive programming gap in middleware. The rest is either correct or minor.

---

### Issues

**1. E2E tests will silently regress** (blocks merging — confirms the Codex comment)

All three existing Playwright specs call `page.goto(BASE_URL)`, `page.goto('.../chat')`, and `page.goto('.../meetings')` without establishing a session first. The new middleware will redirect every unauthenticated request to `/login`, so every assertion in those specs will fail against the login page instead of the actual page.

Files: `frontend/e2e/upload.spec.ts:33`, `frontend/e2e/chat.spec.ts:16`, `frontend/e2e/meetings.spec.ts:15`

The standard fix is a Playwright `globalSetup` that logs in once and saves `storageState`, then each spec loads that state. Example:

```ts
// frontend/e2e/auth.setup.ts
import { chromium } from '@playwright/test';

const authFile = 'playwright/.auth/user.json';

async function globalSetup() {
  const browser = await chromium.launch();
  const page = await browser.newPage();
  // Call Supabase auth API directly — no UI needed
  await page.request.post(`${SUPABASE_URL}/auth/v1/token?grant_type=password`, {
    headers: { apikey: SUPABASE_ANON_KEY },
    data: { email: E2E_EMAIL, password: E2E_PASSWORD },
  });
  await page.context().storageState({ path: authFile });
  await browser.close();
}
```

Then add `storageState: authFile` to `playwright.config.ts` and use `E2E_EMAIL`/`E2E_PASSWORD` env vars (never committed). [Fix this →](https://claude.ai/code?q=Add%20Playwright%20globalSetup%20auth%20for%20Supabase%20session%20in%20frontend%2Fe2e%2F%20so%20existing%20specs%20pass%20after%20middleware%20auth%20guard%20was%20added%20in%20branch%20feat%2F52-supabase-auth&repo=wayes-btye/meeting-intelligence)

---

**2. Middleware crashes silently if env vars are missing**

`middleware.ts:10-11` uses `!` non-null assertions on both env vars. If either is unset in a deployment, every request throws an unhandled error (500 for all pages, no login form shown). A guard at the top would make failures obvious:

```ts
// top of middleware function
if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {
  console.error('Supabase env vars missing — auth middleware disabled');
  return NextResponse.next({ request });
}
```

This lets the app degrade gracefully and surfaces the misconfiguration in logs rather than a 500 loop. [Fix this →](https://claude.ai/code?q=Add%20env%20var%20guard%20at%20top%20of%20middleware%20function%20in%20frontend%2Fmiddleware.ts%20branch%20feat%2F52-supabase-auth%20to%20avoid%20500%20errors%20if%20NEXT_PUBLIC_SUPABASE_URL%20or%20NEXT_PUBLIC_SUPABASE_ANON_KEY%20are%20missing&repo=wayes-btye/meeting-intelligence)

---

### Minor notes (not blocking)

**3. `.env.example` contains the real project URL** (`frontend/.env.example:6`)  
`NEXT_PUBLIC_SUPABASE_URL` is already public-facing by design (it's `NEXT_PUBLIC_`), and the project ID is in `CLAUDE.md` too, so this isn't a secret leak. But `.env.example` files conventionally use placeholder values — `https://your-project-id.supabase.co` would be cleaner.

**4. Authenticated users aren't redirected away from `/login`**  
If a logged-in user navigates directly to `/login`, they see the login form. Not a bug, but a minor UX gap. Worth a follow-up issue if the app grows.

**5. Raw Supabase error messages** (`login/page.tsx:30`)  
`setError(authError.message)` shows strings like `"Invalid login credentials"` verbatim from Supabase. Acceptable for a single-user assessor tool, but consider a generic `"Invalid email or password"` if you want to avoid exposing which field is wrong.

---

### What's correct

- `getUser()` (not `getSession()`) in middleware — correct per Supabase SSR docs; validates JWT server-side rather than trusting the cookie blindly.
- Cookie handling pattern in `middleware.ts:13-27` matches the official Supabase Next.js SSR guide exactly.
- `@supabase/ssr` (not the deprecated `auth-helpers-nextjs`) — right package choice.
- `router.push('/') + router.refresh()` post-login pattern is correct for forcing server component re-render.
- `loading` staying `true` during redirect (no reset on success) is the right UX — prevents double-submit during navigation.
- `autoComplete="current-password"` on the password field — correct for password managers.

---

**Summary:** The auth implementation itself is solid. The two things to address before merging: update E2E specs to handle the auth wall, and add a middleware env var guard. The E2E fix is the more important one since it removes regression coverage for all core flows.

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) commented at [2026-02-21 10:31](https://github.com/wayes-btye/meeting-intelligence/pull/55#issuecomment-3938577484):

Applied review fixes:
- Middleware now returns `NextResponse.next()` early if Supabase env vars are missing — prevents unhandled 500s on fresh deployments
- Middleware now redirects already-authenticated users away from `/login` to `/`
- `.env.example` now uses placeholder URL instead of real project ref

`npm run build` still passing cleanly.

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) commented at [2026-02-21 13:48](https://github.com/wayes-btye/meeting-intelligence/pull/55#issuecomment-3938807212):

Resolved merge conflicts with main (package.json/lock from #54 and #56 merges). All packages preserved from both sides, lock file regenerated via npm install. Build clean.


-------------------------------------------------------------------------------



[Export of Github issue for [wayes-btye/meeting-intelligence](https://github.com/wayes-btye/meeting-intelligence). Generated on 2026.02.28 at 03:55:48.]
