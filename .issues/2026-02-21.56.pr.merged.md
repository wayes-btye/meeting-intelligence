# [\#56 PR](https://github.com/wayes-btye/meeting-intelligence/pull/56) `merged`: feat: delete meeting + meeting title on chat source cards (#42, #43)

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) opened issue at [2026-02-21 09:54](https://github.com/wayes-btye/meeting-intelligence/pull/56):

Closes #42
Closes #43

## Changes

**#42 — Delete meeting**
- `DELETE /api/meetings/{id}` — removes meeting, chunks, and extracted_items; returns 204; 404 if not found
- `frontend/lib/api.ts`: `deleteMeeting()` helper added to `api` object
- Meetings page: trash icon button with AlertDialog confirmation per row; removes from local state on success

**#43 — Meeting title on source cards**
- `SourceChunk` model: `meeting_title: str | None = None` field added
- `search.py`: `_enrich_with_meeting_titles()` — one extra DB query per search to join meeting titles onto chunk results; called at end of both `semantic_search()` and `hybrid_search()`
- `frontend/lib/api.ts`: `meeting_title?: string | null` added to `SourceChunk` interface
- Chat source cards: `from: {meeting_title}` shown when present — most useful when querying 'All meetings'

## Test plan
- `test_delete_meeting` passes
- `test_delete_nonexistent_meeting_returns_404` passes
- All existing tests pass (117 total)
- `ruff check` clean
- `mypy src/` clean
- `npm run build` clean

#### <img src="https://avatars.githubusercontent.com/in/8329?v=4" width="50">[vercel](https://github.com/apps/vercel) commented at [2026-02-21 09:54](https://github.com/wayes-btye/meeting-intelligence/pull/56#issuecomment-3938535278):

[vc]: #wXRvu8RB0A7SbVL1Lh6uz6H4bj6/L8eeSjnWbVj/HoE=:eyJpc01vbm9yZXBvIjp0cnVlLCJ0eXBlIjoiZ2l0aHViIiwicHJvamVjdHMiOlt7Im5hbWUiOiJtZWV0aW5nLWludGVsbGlnZW5jZS13YyIsInByb2plY3RJZCI6InByal8yeVpsaThhOGFGYmdwR28xYXBHeTN6cFN3MzNrIiwiaW5zcGVjdG9yVXJsIjoiaHR0cHM6Ly92ZXJjZWwuY29tL3dheWVzLWJ0eWVzLXByb2plY3RzL21lZXRpbmctaW50ZWxsaWdlbmNlLXdjLzNCa1pjS01HUEV1bXduVjZoQ0V2eVk1V29GaUoiLCJwcmV2aWV3VXJsIjoibWVldGluZy1pbnRlbGxpZ2VuY2Utd2MtZ2l0LWZlYXQtNDItOTg3MzA2LXdheWVzLWJ0eWVzLXByb2plY3RzLnZlcmNlbC5hcHAiLCJuZXh0Q29tbWl0U3RhdHVzIjoiREVQTE9ZRUQiLCJsaXZlRmVlZGJhY2siOnsicmVzb2x2ZWQiOjAsInVucmVzb2x2ZWQiOjAsInRvdGFsIjowLCJsaW5rIjoibWVldGluZy1pbnRlbGxpZ2VuY2Utd2MtZ2l0LWZlYXQtNDItOTg3MzA2LXdheWVzLWJ0eWVzLXByb2plY3RzLnZlcmNlbC5hcHAifSwicm9vdERpcmVjdG9yeSI6ImZyb250ZW5kIn1dfQ==
The latest updates on your projects. Learn more about [Vercel for GitHub](https://vercel.link/github-learn-more).

| Project | Deployment | Actions | Updated (UTC) |
| :--- | :----- | :------ | :------ |
| [meeting-intelligence-wc](https://vercel.com/wayes-btyes-projects/meeting-intelligence-wc) | ![Ready](https://vercel.com/static/status/ready.svg) [Ready](https://vercel.com/wayes-btyes-projects/meeting-intelligence-wc/3BkZcKMGPEumwnV6hCEvyY5WoFiJ) | [Preview](https://meeting-intelligence-wc-git-feat-42-987306-wayes-btyes-projects.vercel.app), [Comment](https://vercel.live/open-feedback/meeting-intelligence-wc-git-feat-42-987306-wayes-btyes-projects.vercel.app?via=pr-comment-feedback-link) | Feb 21, 2026 10:33am |

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) commented at [2026-02-21 10:15](https://github.com/wayes-btye/meeting-intelligence/pull/56#issuecomment-3938557912):

@claude review this

#### <img src="https://avatars.githubusercontent.com/in/1236702?v=4" width="50">[claude](https://github.com/apps/claude) commented at [2026-02-21 10:16](https://github.com/wayes-btye/meeting-intelligence/pull/56#issuecomment-3938558146):

**Claude finished @wayes-btye's task in 2m 20s** —— [View job](https://github.com/wayes-btye/meeting-intelligence/actions/runs/22255048050)

---
### PR Review — feat: delete meeting + meeting title on source cards (#42, #43)

- [x] Gather context
- [x] Read changed files
- [x] Analyze and write review

---

Overall the PR is well-structured and achieves both goals cleanly. Tests are mocked correctly (confirmed `conftest.py` has the `client` fixture), `npm run build` and mypy are clean. A few issues worth addressing before merge, one of which is a confirmed UX bug.

---

### P1 — Pagination not clamped after deletion

`frontend/app/meetings/page.tsx:72-73`

```ts
const totalPages = Math.ceil(meetings.length / PAGE_SIZE);
const pageMeetings = meetings.slice(page * PAGE_SIZE, (page + 1) * PAGE_SIZE);
```

After `setMeetings(prev => prev.filter(...))`, `page` is never adjusted. If you delete the last meeting on page 2 (of 2), `totalPages` drops to 1, the pagination controls disappear, and `pageMeetings` is empty — blank table until refresh. This is the same issue the Codex reviewer flagged.

One-liner fix in `handleDelete`, after `setMeetings(...)`:

```ts
setPage((p) => {
  const newTotal = Math.ceil((meetings.length - 1) / PAGE_SIZE);
  return Math.min(p, Math.max(0, newTotal - 1));
});
```

[Fix this →](https://claude.ai/code?q=In%20frontend%2Fapp%2Fmeetings%2Fpage.tsx%2C%20inside%20the%20handleDelete%20function%20after%20the%20setMeetings%20call%2C%20add%20a%20setPage%20call%20that%20clamps%20the%20page%20index%3A%20setPage%28p%20%3D%3E%20%7B%20const%20newTotal%20%3D%20Math.ceil%28%28meetings.length%20-%201%29%20%2F%20PAGE_SIZE%29%3B%20return%20Math.min%28p%2C%20Math.max%280%2C%20newTotal%20-%201%29%29%3B%20%7D%29%3B%20This%20prevents%20a%20blank%20table%20when%20the%20last%20meeting%20on%20a%20page%20is%20deleted.&repo=wayes-btye/meeting-intelligence)

---

### P1 — `handleDelete` silently swallows errors

`frontend/app/meetings/page.tsx:63-70` and `:161`

```tsx
const handleDelete = async (id: string) => {
  await api.deleteMeeting(id);   // throws on network error / 404
  setMeetings(...)
};
// ...
onClick={() => void handleDelete(m.id)}
```

`void` discards the rejected promise. If `deleteMeeting` fails (network blip, race condition where the meeting was already deleted), the user sees nothing — the row stays and no error message appears. Should be wrapped in try/catch with an error state or toast.

[Fix this →](https://claude.ai/code?q=In%20frontend%2Fapp%2Fmeetings%2Fpage.tsx%2C%20wrap%20the%20body%20of%20handleDelete%20in%20a%20try%2Fcatch%20that%20sets%20the%20existing%20error%20state%20on%20failure%3A%20try%20%7B%20await%20api.deleteMeeting%28id%29%3B%20setMeetings%28...%29%3B%20...%20%7D%20catch%20%28e%29%20%7B%20setError%28e%20instanceof%20Error%20%3F%20e.message%20%3A%20%27Delete%20failed%27%29%3B%20%7D&repo=wayes-btye/meeting-intelligence)

---

### P2 — Delete endpoint deletes data before confirming existence

`src/api/routes/meetings.py:100-106`

```python
client.table("chunks").delete().eq("meeting_id", meeting_id).execute()
client.table("extracted_items").delete().eq("meeting_id", meeting_id).execute()
result = client.table("meetings").delete().eq("id", meeting_id).execute()
data = cast(list[dict[str, Any]], result.data)
if not data:
    raise HTTPException(status_code=404, ...)
```

The chunks and extracted_items deletes run unconditionally. For a valid meeting this is fine. But for a non-existent `meeting_id` you execute two no-op round-trips before returning 404. More importantly, if there were ever orphaned chunks under a `meeting_id` that no longer has a matching meetings row, calling DELETE would silently clean them up but still return 404 — surprising behaviour for the caller. A pre-check `SELECT id FROM meetings WHERE id = ?` before any deletes would make the intent explicit and avoid the wasted calls.

---

### P2 — `_enrich_with_meeting_titles` adds a DB query on every single-meeting search

`src/retrieval/search.py:14-24`

When `meeting_id` is passed to `semantic_search` or `hybrid_search`, the caller already knows which meeting they're querying. The enrichment still issues a DB round-trip to fetch the (known) title. A small optimisation: skip the query when all chunks share the same `meeting_id` that was passed in as a filter parameter.

---

### P2 — Fragile order-dependent mock in `test_delete_meeting`

`tests/test_api.py:108-119`

```python
call_count = 0
def table_side_effect(name: str) -> MagicMock:
    nonlocal call_count
    call_count += 1
    if name == "meetings" and call_count >= 3:
        ...
```

This works today because the delete order in `meetings.py` is chunks → extracted_items → meetings. If that order changes (e.g. a new table is added first), `call_count >= 3` breaks silently — the mock returns the wrong result and the test passes for the wrong reason. A cleaner approach is a dict dispatch:

```python
def table_side_effect(name: str) -> MagicMock:
    tbl = MagicMock()
    if name == "meetings":
        tbl.delete.return_value.eq.return_value.execute.return_value = meetings_delete_result
    else:
        tbl.delete.return_value.eq.return_value.execute.return_value.data = []
    return tbl
```

This is independent of call order and clearly expresses intent.

[Fix this →](https://claude.ai/code?q=In%20tests%2Ftest_api.py%2C%20replace%20the%20call_count-based%20table_side_effect%20in%20test_delete_meeting%20with%20a%20dict-based%20dispatch%3A%20def%20table_side_effect%28name%3A%20str%29%20-%3E%20MagicMock%3A%20tbl%20%3D%20MagicMock%28%29%3B%20if%20name%20%3D%3D%20%22meetings%22%3A%20tbl.delete.return_value.eq.return_value.execute.return_value%20%3D%20meetings_delete_result%3B%20else%3A%20tbl.delete.return_value.eq.return_value.execute.return_value.data%20%3D%20%5B%5D%3B%20return%20tbl&repo=wayes-btye/meeting-intelligence)

---

### Minor / Non-blocking

- **`lib/api.ts:97-100`** — `deleteMeeting` uses raw `fetch` (necessary since `apiFetch` calls `res.json()` which fails on 204 No Content), but the error message `Delete failed: ${res.status}` diverges from the `API ${status}: ${text}` format everywhere else. Fine to leave as-is, but worth noting for consistency.
- **`search.py:23`** — `_enrich_with_meeting_titles` mutates the input chunk dicts in-place. Not a bug, but could be surprising if chunks are referenced elsewhere after the call.

---

### Summary

| # | Severity | File | Issue |
|---|----------|------|-------|
| 1 | P1 | `meetings/page.tsx:65` | Pagination not clamped after delete → blank page |
| 2 | P1 | `meetings/page.tsx:63` | No error handling on `handleDelete` → silent failure |
| 3 | P2 | `routes/meetings.py:100` | Delete data before confirming existence |
| 4 | P2 | `search.py:14` | Extra DB round-trip on single-meeting searches |
| 5 | P2 | `test_api.py:110` | Brittle call-order-dependent mock |

Issues 1 and 2 are worth fixing before merge since they affect real UX. The rest can be deferred or tracked as follow-ups.
 | [Branch preview](https://meeting-intelligence-wc-git-feat-42-987306-wayes-btyes-projects.vercel.app)

#### <img src="https://avatars.githubusercontent.com/u/151667361?v=4" width="50">[wayes-btye](https://github.com/wayes-btye) commented at [2026-02-21 10:32](https://github.com/wayes-btye/meeting-intelligence/pull/56#issuecomment-3938579047):

Applied P1 review fixes:
- Pagination clamped after delete — `setPage` adjusted so users can't be stranded on a blank page after deleting the last item on a page
- `handleDelete` wrapped in try/catch — errors now surfaced to the user via `deleteError` state rendered above the table; `void` no longer silently swallows failures

`npm run build` and all 117 tests still passing.


-------------------------------------------------------------------------------



[Export of Github issue for [wayes-btye/meeting-intelligence](https://github.com/wayes-btye/meeting-intelligence). Generated on 2026.02.27 at 04:14:01.]
