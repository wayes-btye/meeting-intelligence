# Worktree WT15 — Issue #49
**Status:** `ACTIVE` — Phase 1 implemented, PR #60 open

---

## Context: What you need to know about this codebase

**The system is a RAG-based meeting intelligence tool.** FastAPI backend, React/Next.js frontend (`frontend/`), Supabase (pgvector), Claude for generation, OpenAI for embeddings.

**CRITICAL codebase patterns:**
- Frontend chat page: `frontend/app/chat/page.tsx`
- API query endpoint: `src/api/routes/query.py` — `POST /api/query`
- Query request model: `src/api/models.py` — `QueryRequest`
- Search: `src/retrieval/search.py` — `semantic_search()`, `hybrid_search()`
- All 117 tests pass on main. Do not break them.
- mypy is passing — run `ruff check src/ tests/` AND `mypy src/` before PR.

---

## Scope for this worktree: Phase 1 only

**Phase 1 (implement now):** Display-only parameter info block — pure frontend, no API changes.
**Phase 2 (defer):** Tweakable sliders with API param threading — leave as a follow-up issue.

This keeps the scope clean and shippable without touching the retrieval pipeline.

---

## Your mission

Show retrieval parameters in the chat UI so the assessor can see exactly what the system is doing. Also surface the model name and token usage from the API response.

**No API changes for Phase 1.** All values are either hardcoded constants or already in the API response.

---

## What to build

Read `frontend/app/chat/page.tsx` in full before starting. Understand the existing structure: strategy radio buttons, query input, results display.

### 1 — Parameter info block (below strategy selector)

Below the chunking/retrieval strategy radio buttons, add a small info block that updates based on the selected strategy:

```tsx
// Semantic strategy info
const semanticParams = {
  model: 'text-embedding-3-small',
  top_k: 10,
  metric: 'cosine',
}

// Hybrid strategy info
const hybridParams = {
  vector_weight: 0.7,
  text_weight: 0.3,
  top_k: 10,
}
```

Render based on selected retrieval strategy:
```tsx
<div className="text-xs text-muted-foreground bg-muted/50 rounded p-2 space-y-1">
  {retrievalStrategy === 'semantic' ? (
    <p>model: text-embedding-3-small · top_k: 10 · metric: cosine</p>
  ) : (
    <p>vector_weight: 0.7 · text_weight: 0.3 · top_k: 10</p>
  )}
  <p className="text-xs opacity-70">
    Chunking: {chunkingStrategy === 'naive' ? 'Fixed-size (naive)' : 'Speaker-turn'}
  </p>
</div>
```

Add a tooltip `?` icon next to each strategy label explaining it in plain English. Use shadcn `Tooltip` component if already imported — check existing imports first. If not, use a plain `title` attribute as fallback.

Strategy explanations:
- **Naive chunking:** "Splits transcript into fixed-size token windows with overlap. Fast and simple — ignores speaker boundaries."
- **Speaker-turn chunking:** "One chunk per continuous speaker segment. Preserves conversational context. Better for attribution."
- **Semantic retrieval:** "Finds chunks by embedding similarity. Good for conceptual questions."
- **Hybrid retrieval:** "Combines vector similarity (70%) + full-text search (30%). Better recall for specific terms and names."

### 2 — Model + usage display below the answer

After an answer is returned, the API response includes `model` and `usage` fields. Show them below the answer:

```tsx
{result.model && (
  <p className="text-xs text-muted-foreground mt-2">
    Generated by {result.model}
    {result.usage && (
      <span> · {result.usage.input_tokens} in / {result.usage.output_tokens} out tokens</span>
    )}
  </p>
)}
```

Read the existing `QueryResponse` interface/type in the chat page or `frontend/lib/api.ts` to confirm the field names for `model` and `usage`.

### 3 — Empty-state message for structured lookups

When the API returns sources with zero chunks (structured DB lookup route), the current UI may show nothing or look broken. Add a note below the answer:

```tsx
{result.sources.length === 0 && (
  <p className="text-xs text-muted-foreground italic mt-1">
    Answer retrieved from structured database — no transcript chunks used.
  </p>
)}
```

---

## Testing

### Automated
```bash
npm run build   # TypeScript must compile cleanly
python -m pytest tests/ -m "not expensive" -q  # regression check — no backend changes
```

### Visual (manual — describe in PR comment)
Run dev server + API, then:
- Switch between Semantic and Hybrid — verify the parameter block updates
- Ask a question — verify model name + token usage appears below the answer
- Ask a structured query ("list action items") — verify the empty-state message appears
- Hover strategy labels — verify tooltips appear

The PR description must include a short paragraph describing manual testing performed.

---

## Definition of done

- [ ] Parameter info block shows correct values for semantic and hybrid strategies
- [ ] Values update when strategy is switched
- [ ] Tooltip (or title) explanation on each strategy label
- [ ] Model name + token usage shown below answer when present
- [ ] Empty-state message when sources.length === 0
- [ ] `npm run build` clean
- [ ] `pytest tests/ -m "not expensive"` all pass
- [ ] Manual testing described in PR comment

---

## Phase 2 — deferred (do NOT implement)

The following is explicitly out of scope for this worktree and should not be touched:
- Exposing `vector_weight`, `text_weight`, `match_count` as API params
- Slider components wired to live retrieval
- Any changes to `src/retrieval/search.py`, `src/api/routes/query.py`, or `src/api/models.py`

Leave a comment in the code where sliders would be added: `{/* TODO #49 Phase 2: add vector_weight/text_weight sliders here */}`

---

## Port allocation
- No separate API port — pure frontend work
- Use main workspace API at `http://localhost:8000`
- Frontend dev: `cd frontend && npm run dev`

---

## How to raise the PR

```bash
git add frontend/app/chat/page.tsx
git commit -m "feat: RAG parameter display + model/usage info in chat UI (#49 Phase 1)"
gh pr create \
  --repo wayes-btye/meeting-intelligence \
  --base main \
  --head feat/49-rag-param-display \
  --title "feat: RAG parameter display in chat UI (#49 Phase 1)" \
  --body "Partial close #49 (Phase 1 — display only)

## What this adds
- Parameter info block below strategy selector showing model, top_k, weights per strategy
- Tooltip explanations on each strategy label
- Model name + token usage shown below answers
- Empty-state message when answer comes from structured DB (zero chunks)

## Phase 2 (deferred)
Tweakable sliders wired to API params — requires threading params through QueryRequest + search.py. Left as follow-up.

## Test plan
- npm run build clean
- Manual: verified parameter block updates on strategy switch, model/usage displays, empty-state on structured query"
```
